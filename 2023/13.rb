input = <<~INPUT
#.##..##.
..#.##.#.
##......#
##......#
..#.##.#.
..##..##.
#.#.##.#.

#...##..#
#....#..#
..##..###
#####.##.
#####.##.
..##..###
#....#..#
INPUT

input = <<~INPUT
.##.##....##...
.....#.#.#..#.#
.....#.#.#..#.#
.##.##....##...
..###.#.##..#.#
#.###.#.#######
##..#..###.####
##.#.#.######.#
..#.#....##..#.
..###..##......
....#...#.#...#
....#...#.#...#
..###..##.#....
..#.#....##..#.
##.#.#.######.#

##..#...#.#..#.
##.###...###..#
...#.#####....#
..##.#####....#
##.###...###..#
##..#...#.#..#.
..#..###.#####.

###......#.###.
#..#.##....##.#
##.#.##....##.#
###......#.###.
#..###.#..#....
..#.....##....#
#..##..###.#..#
#..##..###.#..#
..#.....##....#
#..###.#..#....
###......#.###.

#####..#..##..#..
##..#............
.##.##..######..#
#..#.#.#..##..#.#
.#.#..##..##..##.
...#....##..##...
##.#..##.#..#.##.
.##..#.########.#
..#####.##..##.##
.###.#.#.#..#.#.#
.###.#.#.#..#.#.#
..#####.##..##.##
.##..#.########.#
##.#..##.#..#.##.
...#....##..##...
.#.#..##..##..##.
#.##.#.#..##..#.#

#.#.#######
#...#.#.##.
##..#.#.##.
#.#.#######
##.#.##.##.
.##..#.#..#
#..#####..#
#.##.#.####
.##.####..#

......##...###.
.###.#.#..#.#.#
#.#....###.###.
..#..#.#####..#
#.#...#.#...##.
#.#...#.#...##.
..#..#.#####..#
#.#....###.###.
.###.#.#..#.#.#
......##...###.
.#..####...####
.####.######...
.####.#######..

...####...#.#..##
###....#####..#..
...####.....###..
.##....##..##..##
..######..##..#.#
...####.....#.##.
....##.....#.##..
##..##..###.#####
...#..#.....###.#
##.####.###.#....
##..##..##.#.####

#..###...###...
#.##..#.#...##.
#.#...#.#.####.
###....##...##.
##.....#.###...
.#.....#.##...#
.#.....#.##...#
##.....#.###...
###....##...##.
#.#...#.#.####.
#.##..#.....##.
#..###...###...
.##.####.#####.
.####.##...##.#
.####.##...##.#

..#.#####....
..#.#####....
#.#.#.###..#.
.#.#.....#.##
..#.###.....#
.##...##.....
#....#.....##
..####.#.....
.#.###..##.##
#..#####.#.##
#..#####.#.##
.#.###..#####
..####.#.....

.#.##.###..
#...##.#.##
..#.#...#.#
..#.#...#.#
#...##.#.##
.####.###..
##..#.##.#.
.####.#...#
...###.#.##
.#.#...###.
.#.#...###.
...###.#.##
.####.#...#
##..#.##.#.
.####.###..

.#..#..#..##.
##..#..#..##.
####..#...###
.#..####....#
.###.#.#....#
.#.##..#..#.#
.....##......
....##..#..#.
###.##.#..##.
#.#....###...
#.#....###...
###.##.#..##.
....##..#..#.
.....##......
.#.##..#..#.#

..##..#
####.#.
...#...
...##..
####.#.
..##..#
..#.#.#

.##.##.##....##
#..#..#..####..
#..####..#.##..
#.#.##.#.#..#.#
..######..##..#
###.##.########
#.######.####.#

#.##.##..##.#
..##..######.
...#.##.###..
.#..##.#.#.#.
.#.#.#.##..##
.#.#.#.##..##
.#..##.#.#.##
...#.##.###..
..##..######.
#.##.##..##.#
##..#...#..#.
.#.#..#..##.#
##..#####.#..
##....##.#.##
##....##.#.##
##..#####.#..
.#.#..#..##.#

#.##.##
...##..
##..##.
#...#..
#...#..
##..##.
#..##..
#.##.##
##.#..#
##.#..#
#.##.##

....##.....
##.####.###
##..##..###
.########..
.#......#..
.########..
..######...
###.##.####
..#.##.#...
....##.....
##.#..#.###
####..#####
##.####.###
..#....#...
##..##..###
##.####.###
.....#.....

###..###...##..
###..###..#.###
.######.####...
..####....#####
##.##.##..#.###
#......#.#..#..
#.#..#.###..#..
#..##..##.#....
#.####.#.####..
.#.##.#.##.####
.######...###..
##....##.#.###.
........#.#####
##....###..##..
#########..##..
.######..####..
##.##.#####.###

##...#.#.###..#
#.####..#.##.#.
.##.##..#.##.#.
###..#..#.##.#.
.#.##...##..##.
.#...#..######.
.###.#.........
.###.#####..###
.###.#####..###

########.#.##
########.#.##
..#.#.#.###.#
#..#.###..#.#
..#..######.#
###....#.#.##
..#..#.#..###
..#..#####...
...###.#.#..#
##....#.#..#.
....#....##..
.....#####...
###.###.#....
..###..#...#.
##.#...##...#
###...##.##..
##.#....#.#.#

....######.
#..###..###
.....#..#..
#####.##.##
.##...##...
....######.
....##..###
.##.#.##.#.
.##.######.
.##........
....######.
.##..#..#..
#..#.#..#.#
.##.#....#.
####..##..#
....######.
#..#..##..#

##.#....#######
..###...##..##.
..###......###.
...#...#....##.
######.##.###..
..###.......#.#
##.#.###..##.##
###.###.######.
##...###.#...#.
..##.##.#.###..
..#.#..###..#..
...#..#..###.##
..##.....#..#..
..##.....#..#..
...#..#..###.##
..#.#..###..#..
..##.##.#..##..

.#..####.#.
.#..####.#.
..........#
.#..######.
.#...##.##.
#####.####.
#..#....###
#..#....###
#####.####.
.#...##.##.
.#..######.
#.........#
.#..####.#.

####.#.
##..#.#
###..#.
..#.#..
..#.#..
###..#.
##..#.#
.###.#.
.###.#.
##..#.#
###..#.

.#....##.#.###.
.....####.#..##
....##.####.##.
##...##..###.##
.#.#..#.###..##
####.#.#.##...#
.#.###.##.#..#.
.#.######..##.#
.#.######..##.#
.#.###.##.#..#.
####.#.#.##...#
.#.#..#.##...##
##...##..###.##
....##.####.##.
.....####.#..##
.#....##.#.###.
.#....##.#.###.

###..########
########..###
.##..##....##
##.##.##..##.
###..########
.#....#.##.#.
.##..##....##
..#..#..##..#
.######....##
.##..##.##.##
##.##.######.
..#..#..##..#
.#.##.#....#.
#.####.####.#
.##..##....##
##.##.##..##.
..#..#...#..#

##..#...#
.##.#.##.
......#..
##.####..
...###..#
###.##.#.
###.##.#.

###..###.####..
###..###.####..
#.####.#..##...
........#....#.
##....##..##...
#.#..#######...
..####...#.##.#
..#..#....#.#.#
..####...####..

####.##..###..###
...##.###...###..
..###.#.#####.#..
##.#..#####.#.#..
.#..#.#.#...#.###
...##..##...##.##
...#..#.###..#...
..###.##.#.#.....
#.##..##..#.#..##
.######...####...
.######...####...
#.##..##..#.#..##
..###..#.#.#.....

..##.####
.#....##.
.##..#..#
..#.#.###
.##..#..#
##.#.#..#
##.#.#..#

..###..#..#....#.
...##..##.######.
...##..##.######.
..###..#..#....#.
..##.##.##.#..#.#
#...#.###..####..
.##....#..##..##.
######...########
######.#####..###
.#....#..#......#
##....#.#.######.
.##.###.#..####.#
#.#.#####..#..#..
#####.#.##.#..#.#
#.#######........

..#########
...##.##.##
###........
##..##..##.
..#........
..##..##..#
###..####..
...#.#..#.#
##..#....#.
..#...##...
...##....##
##.#.#..#.#
####...#..#
..##.####.#
...#..##..#

...#.####
..###..##
.###.#..#
###.##.##
.##...###
###.##...
###.##...
.##...###
###.##.##
.###.#..#
...##..##
...#.####
.##....##
.##....##
...#.####

..#...##.
#.#.##..#
######..#
...#.#..#
#...#....
.#...####
.#...####
##..#....
...#.#..#

..#..###.#.
..#.####.#.
.###....##.
##.#...###.
#..##..#..#
#..##..#..#
##.#...###.

...########...#
#.#........#.#.
#....#..#....#.
...#......#...#
.#...#..#...#.#
#.#..#####.#.##
..#..####..#...
..###....###...
..#.#.##.#.#..#
..#...##...#..#
..#...##...#..#

..#..###.##..##.#
..#..#.#.##..##.#
##....#.#.####.#.
#.#.###..........
...#..##.#....#.#
...###..#.#..#.#.
...##...#.#..#.#.
#..#.##.###..###.
#..##.####....###
.#.#...#.##..##.#
#....##..##..##..
#.#.....#.#..#.#.
##.#.###..#..#..#
.##.....#......#.
#..#....########.

#####..
..####.
..####.
###.#..
..#....
###...#
.#..##.
...#.##
...##..
.#...#.
.#...#.
.######
.######
.#...#.
.#...#.
...##..
...#.##

.#.####
.#.#..#
#......
#..####
###....
.#.####
###....
###....
##.####
###....
#..####
#......
.#.#..#

...##.#.#..###..#
###.#...#...#..#.
.#.#.##.#.#..##.#
.#.####.#.#..##.#
###.#...#...#..#.
...##.#.#..###..#
#....#...##..#.##
#.#...#####....#.
#.#...#####....#.
#....#...##..#.##
...##.#.#..###..#
###.#...#...#..#.
.#.####.#.#..##.#

..####.#...
..##.#..#..
..##.#..#..
..####.#...
..#..#.#.##
...##..##.#
..#.#.##.##
....#.#..##
#####..#..#
###.#.#.###
...#.####.#
.....##....
#.#.....#..
....##...#.
##....##...

#####....###..###
#####..#.###..###
#####.####....#..
.#..#....#.#.#.##
#....#......#..##
#..#.##.##..#.#..
.###..##.#.#.....
..#..#.###..#####
..#....#..#.##...
#.#.###.#.#.#....
..#.....###..####
.##.###.##.##..##
#.#.##....##...##

##..#.####.#..#
###.########.##
.#..#......#..#
######.##.#####
##..#......#..#
##..##....##..#
#.##.#.##.#.##.

##.####..##
..#.#..##..
...#.######
.###.######
###....##..
##...######
.###...##..
..#.#..##..
.##...#..#.
.##........
#..#.######
#...###..##
#....######
.#.........
#.###..##..
###....##..
#.#########

#.##...###..##..#
#.###.###...#.#..
#.###.###...#.#..
#.##...###..###.#
#...#....#...#.#.
#....##.##..#####
..##..#####.##..#
###.#####.#.###.#
#####..##.#####..
.#..#.##.#.#...##
##.....#.#.#.###.
##.....#.#.#.###.
.#..#.##.#.#...##

...####.###.###..
###.#.#..###.#.##
...#######..#....
...####..#..##...
......#.#########
....#.#..####.###
.....#....##..##.
....#..##..#.#.##
..#..#...#.##.#..
...#..##.#.##..##
...#.#.#.#.#.##..
###.#.##...#..###
..####..###..#...
..#..#.#.....####
.....#.###..##.##

..#####
#..#.#.
#..##..
.....##
#.#..##
.#.####
####.##
####...
..##...
.#.....
.#.....
..##...
####...
####.##
.#.####

.##.##.##..
.##.##.##..
###....###.
#.##..##.##
#...##...#.
.#.####...#
####..####.

#..##.#.#..#....#
####.##.###..##..
##....#.##..####.
#...#####.#######
#....####.#######
##....#.##..####.
####.##.###..##..
#..##.#.#..#....#
#..####.###......
##..#..##.#######
..#.#....#.#....#

###.#..#.
.#.#...##
.###...##
###.#..#.
...#..###
###.##.##
.#.#.#..#
#.....#.#
.###.##.#
#.#.#...#
..#......
#.#..###.
....##...
#.#....#.
.....####
.....####
#.#....#.

..##.##.##....###
..##.##.##...#.#.
##..#..#..##..##.
.##......##.#..#.
.##......##.#..#.
##..#..#..##..##.
..##.##.##...#.##
..##.##.##....###
..#.#..#.#..#.##.
.##.####.##.##..#
##..####..####...
.###....###.####.
.#........#.#...#

..#####..#..#..
##......#.##.#.
####.##.##..##.
###..##.#....#.
##.##..##....##
##..#..#..##..#
#...#..##....##
..#..#.........
..###.#.#.##.#.
...#..#..#..#..
.....##.######.

####.#..#.##.
####.####.###
...#.#..#.#..
##.#......#.#
...#.#..#.#..
..####..####.
###.#.##.#.##

..###..##..
.#.#.#....#
.###.##..##
..#..#.##.#
.#.##.#....
..##.##..##
#...###..##
#...###..##
..##.##..##

..##.#.#.##
#.##..#####
#..........
#....#.....
#.##..#####
..##.#.#.##
###.#..#..#
...##.##..#
#.####.##.#
...#..#....
.#.##....##
.#.##....##
...#..#....

###..#.
...#..#
..#.###
###.###
...#..#
###..#.
...####
...####
..##.##
..#...#
...#.##
##..#..
..#....
..#..##
..#.###

#....#.#.#...
#.###.###.###
.####..##.#..
....#...##.##
.#####.......
.#####.......
....#..###.##

..##..##..#
##...#.####
#...##.#..#
##...######
##.##..####
#.....#.##.
#..#..#.##.

.#..#...#...##.
.#..#...#.#.##.
###...####..##.
###...##.#.....
.#.#..#....####
.#...####.#.##.
...#####...####
##.##.#.###.##.
####..##...#..#

.....#.
.....#.
###....
######.
##..#..
#.#...#
#......
#......
#.##..#

########.##.#
######.##..##
#.##.###.##.#
.......######
.#..#..######
##..##..#..#.
.####.#######
..##....####.
#.##.########
#.##.###.....
#....#..####.
##..##.#.##.#
#....#.#....#
.####........
......#.####.

.#.#.#..###
..#.#####..
.#...#...##
###..#.#.##
.####..#...
.#.#.#...##
...##......
#.....##.##
.##...#..##
#######.#..
.######.#..
.##...#..##
#.....##.##
...##......
.#.#.#...##

#####........#.
...#.##.##..#.#
..#.#.###.#.###
...###.####....
##...#.#..#....
##...#.#..#....
...###.####....
..#.#.###.#.###
...#.##.##..#.#
#####........#.
.#...##...#.##.
.#.####.##.#.#.
.#.####.##.#.##

.#...#.##..
##.##.#.###
##.#.....##
.........##
..##.#..###
.#.#.#.##..
#.......###
#.......###
.#.#.#.##..
..##.#..###
.........##
##.#.....##
##.####.###

....#..#....#....
##...##...##..##.
#.##.##.##.####.#
###.####.########
###.#..#.########
..###..###......#
.#.######.#....#.
..#.#..#.#......#
.#..####..#....#.
..#..##..#..##..#
##.#.##.#.##..##.
#..##..##..####..
####.##.#########
#.#.#..#.#.####.#
...#.##.#........

##.##.##.#.#..#.#
#.####.##########
...##...#..####..
..#..#..#.######.
.#....#.##..##..#
.#....#.#.##..##.
#..#...#.........
..#..#.....####..
.#....#.###....##
..........##..##.
..#..#..#########
..........#.##.#.
.#....#.#........
...##............
..#..#..#.######.
.######.#...##...
###..###.###..###

...#....##.##
###.####.###.
###.####.###.
...#....##.##
.#..####.##.#
..#...#....#.
#..#..#..##..
###.##..#..#.
..#####.###..
####.........
.####.##..##.
.#.#.###..##.
.#.#.###..##.
.####.##..##.
####.........
..#####.##...
###.##..#..#.

.#.############
#....#.####.#..
#.#.#...##.#.#.
..##.##....##.#
....##.#..#.##.
..##..######..#
#####........##
.#.##...##...##
.##############
####.########.#
####.########.#
.##############
.#.##...##...##

##..#########
##..#.##.#.##
..###...#.###
#####...##.#.
#####...##.#.
..###...#.###
##..#.##.#.#.
##..#########
#####.#.##.##
##....#...#..
##.#.####.#.#
##.##.###....
...#.#.#....#
##.#..###.###
...#.##....#.

####.###.
.######.#
.##.##.##
#..#.##.#
....#.#..
#..#..##.
....#.###
########.
########.

....#...#
#####....
#####....
....#...#
#..#.####
#..#..#..
.##...#.#
.##...#.#
.#.....##
#..#..##.
########.

.#..####...#.##
.#..#####..#.##
##.#.#..#.#....
#.#.##.#.##....
.#.##..##..####
.#....##...##..
#.###..#.#.#.##

#.#...#
#...##.
.#.....
.#.###.
.#.###.
.#.....
#...##.
#.##..#
#.##..#
#...##.
.#.....

######.
#......
..####.
.######
#......
.#.##.#
.#.##.#
#......
.######
..####.
#......

..#######
#.##.##.#
#.#######
.########
....#..#.
..#......
#.#......
.#.#....#
.##.####.
#........
.#...##..
.#...##..
#.#......

##...##...#
##.#....#.#
.....##....
####....###
..##....##.
.....##....
##.##..####
..#..##..#.
###..##..##
.....##....
##.######.#

#..##.#....#.
#....#..###.#
#....#..###.#
#..##.#....#.
.##.#.....##.
.#.######.##.
.###.##.####.
..##.##.####.
.#.######.##.
.##.#.....##.
#..##.#....#.

.##....
#..#..#
..##..#
####..#
.##.##.
#.#....
.#.....
#.#....
###....

##.#.......#...#.
##...#....##..###
.#..#.#...###.###
.###.#..###.#.#..
######..........#
######..........#
.###.#..##..#.#..
.#..#.#...###.###
##...#....##..###
##.#.......#...#.
#####..##.#####.#
#..#.##...##.####
#..#.##...##.####

..#..#..###..
.####.##...#.
.###..######.
.###...#####.
.####.##...#.
...#.#.##...#
#...#..#.##.#
.######.##..#
#.##.##.#.###
#.##.##.#.###
.######.##..#
#...#..#.##.#
...#.#.##...#
.####.##...#.
.###...#####.
.###..######.
.####.##...#.

#.#........
..#.##.####
##...######
..###......
##.##.##..#
......##..#
.#.##..####
##..#.#....
..##.#.####
.#.#....##.
#####.#.##.
.####.#.##.
.#.#....##.
..##.#.####
##..#.#....
.#.##..####
......##..#

#####.#..##
#..###.###.
.##..####.#
.##..####..
#..###.###.
#####.#..##
.........#.
.##...#.###
.##.####..#
....###.###
#######.#..

#.###.#.#.#.#.#
.##..###..###..
..#.##...####.#
..#.##...#.##.#
.##..###..###..
#.###.#.#.#.#.#
.....#....##.#.
.........#####.
......#.......#
..###.#####.###
.###..###.#.###
.##.#..#####.##
.##.#..#####.##
.###..###.#.###
..###.#####.###
......#.......#
.........#####.

.#.##..##
...#..#..
###..#.##
##...#.##
##.####..
.#..##.#.
.#..##.#.
##..###..
##...#.##
##...#.##
##..###..
.#..##.#.
.#..##.#.
##.####..
##...#.##

.#.###....###.#
######....#####
######....#####
.#.###....###.#
.####..##..####
##..##....##..#
.##.###..###.##
....#.#..#.#...
##.#.######.#.#
#.###..##..###.
..##.######.##.
##.#.######.#.#
..#.#.####.#.#.
.#....####.#..#
#.#..#....#..#.

##.#.#...#.##
#...#..##.#..
#...#..##.#..
##.#.#...#.##
....##.##....
.#....####.##
...#...##..#.
###.#..#...#.
....##...#.##
.#..##...#.##
###.#..#...#.

........#..#.#.##
#.#..#.######.#..
.#....#..#.######
..####...#...#...
#..##..#.##.##...
##.######.#.#..##
#......#..#..#.##

###.##..#..##..##
##.#.##.##..####.
..#.#.##.#..#..#.
##...#..#...####.
###.##.....#.##.#
...#.....#.#....#
...####..##.#....
##.##.##..#......
###...#..#.#....#

##..##..######.
###....########
###.##.########
#........#..#.#
.#.####.#.##.#.
...####...##...
##########..###
##.#..#.##..##.
.##....##....##
##..##..##..##.
....##.........
##......##..##.
.#.####.#.##.#.
.##....##.##.##
.#.####.#.##.#.
.#.####.#.##.#.
#.#....#.####.#

####..###..##
.#......####.
#...#########
#....#.......
.#.##.#.####.
.....##......
.....##......
.#.##.#.####.
#....#.......
#...#########
.#......####.
####..###..##
###..##.#..#.
.#..#.#......
##..#.##.##..

#.##.##
....#..
#..##..
....###
.##.###
....###
####.##

##.####
..###..
..###..
##.####
##..###
.#.....
#..#.#.
.#####.
...#.##
..#.##.
.#.....
....###
#.##...
..#.##.
..#.#..

####.##
..###.#
##.###.
..#.#.#
##.#.##
##.#.##
..#.#.#
##.###.
..###.#
##.#.##
##.#.##
##..###
##..#.#
..##...
##.#..#

#.#.###
#####..
#.#.#..
...##..
..#.#..
#..####
.####..
.##.#..
###....
###.###
##.####
.#.####
##..#..
.#.#...
.#..###
#.#.#..
#.###..

..####..####.##.#
###..###..#######
..####....###..##
...##...###..##..
..........###..##
##.##.####...##..
.#.......#.......
#......##.#######
.##..##.#.#.####.

#####.###
..######.
####..###
####..###
##......#
###.##.##
..######.

.#.#....#
#.......#
#..#.###.
...#.#...
...#.##..
#..#.###.
#.......#
.#.#....#
##....##.
.##.###.#
.##.###.#

.###.####
.#.#..#..
###..#...
#..#..#..
#.#####.#
.####..##
.####..##
#.#####.#
#..#..#..
###..#...
.#.#..#..
.###.####
......##.
...#..#..
......#..

#.#..##..#.
#...#..#...
..###..###.
#..##..##..
.....##.#..
##........#
..##.##.##.
.##......##
.##......##

..##.######
#.##.######
###..######
##..#######
.#.#..####.
....#......
.#.#.......
#.#.#######
##.##......
.###.#.##.#
......#..#.
.##........
###.#......
#...##.##.#
#.#..##..##

##..##...##..
##..##...##..
#.##.#.#.#.##
.#..#.###.#..
#....###.#.#.
##..##.#.####
##..##....###
#........##.#
#.##.##..##.#
INPUT

maps = input.split("\n\n").map { |map| [map.split("\n").map(&:chars), Hash.new { |h, k| h[k] = {} }] }

def solve_map(map, result, direction, idx, part: 1)
  map = case direction
        when :vertical_forward
          map
        when :vertical_backward
          map.map(&:reverse)
        when :horizontal_forward
          map.transpose
        when :horizontal_backward
          map.transpose.map(&:reverse)
        end

  found = nil

  0.upto(map[0].size / 2) do |i|
    break unless found.nil?
    if map.all? { |row| row[0..i] == row[i+1..i*2+1].reverse }
      found = i + 1
    end
  end

  res = if direction.to_s.include?('backward')
    found.nil? ? nil : map[0].size - found
  else
    found
  end

  if part == 2
    if result[1][direction] != res
      result[part][direction] = res
    end
  else
    result[part][direction] = res
  end
end

def solve(maps, direction, part: 1)
  maps.each_with_index do |(map, result), idx|
    found = nil

    0.upto(map.flatten.size-1) do |i|
      break unless found.nil?

      if part == 1
        found = solve_map(map, result, direction, idx, part:)
      else
        row, col = i / map[0].size, i % map[0].size

        tmp = map[row][col]
        map[row][col] = tmp == "." ? "#" : "."
        found = solve_map(map, result, direction, idx, part:)
        map[row][col] = tmp
      end
    end
  end

  maps.map { |_, result| result[part][direction] }
end

[1, 2].each do |part|
  vertical = solve(maps, :vertical_forward, part:).zip(solve(maps, :vertical_backward, part:))
  horizontal = solve(maps, :horizontal_forward, part:).zip(solve(maps, :horizontal_backward, part:))

  puts "Part #{part}"
  puts vertical.map { |arr| arr.compact.first }.compact.sum +
    100 * horizontal.map { |arr| arr.compact.first }.compact.sum
end
