input = <<~INPUT.strip
.|...\\....
|.-.\\.....
.....|-...
........|.
..........
.........\\
..../.\\\\..
.-.-/..|..
.|....-|.\\
..//.|....
INPUT

input = <<~INPUT.strip
\\...\\..........|..\\........../...............................\\.\\.....................................-........
..........................--............/.....-.../............-........................\\./.\\|\\...............
...|.-\\.|.......|......../.....-........|........................\\......|..............\\......|...............
...-\\.....................\\......../....../..............................|........-.........\\...-\\....-.......
.........\\|............/-....-......-................\\....-........|./.........-..|....................|......
..-.....\\........................-.....-..../..............||.............-.................|..........-.-././
......................-\\......................................-/......||.........-.-......./..................
|..\\................|.....\\.............\\.......|........-..................\\|.................|...-..........
............................|.....|.......\\../..........\\......\\../..|..../........-..\\.-......-..............
\\....-.....................\\....../............-/..|.........../-.........|.../................\\.......|\\...//
.......-.-........../........-.........\\..../......................|.............|.....\\....|......../........
.../......../.........|.....-.............|.....\\\\-.|..\\..........\\..|...............-.|...........-......-../
............./.............../......./.................-.................|/...||............|.............|\\..
...................-..................................../.\\..................|..........|........|...../..|./.
.........................|......\\..../...........|..-......|..-.-../..\\.......\\............................|..
.........\\..|...............//.........|................|................................./..-..-.............
......||...........|...|../.............../....-......|..\\.....-..........\\..................\\.........../....
............../-......|.................-......|........-...--................./.............|..........\\.....
......\\.|./...........\\...................\\..-.........-.....-.-.......|./....................../.|..\\|.......
./...........\\..|...................../....................................\\../.................\\...........\\.
..............|............................./...\\.............../.....-.........\\./..-.../\\\\..................
\\./|......\\............|.........................|....-../.......\\........./.............../-........../....\\.
....-................................\\....................../.|...|.................-...|.......--............
.......-....\\/../.................-/...-./...-...........................-.............\\...........|..........
................................................\\........./............../.....|.......\\......|........\\./....
..........-..../......-.............|...-.....\\..-......................-..\\.....|....../....\\./.....|........
.......-...../..................-....../........./......./..............|......-....|....|.\\....|......-./-...
......\\/.....................|.-.........-.....\\.....................-.-....|.................|.-\\./..........
............\\...........-................|....|....|-......\\..|/............\\........-...-..........-....\\....
...\\............-...........|.............|...............-......|.............\\..\\................\\..........
...........................|..........|..................\\..\\........|...../......|....|..........-...........
.......-.../..................-...\\\\.....\\..-.....|/..................................-.........../...........
/......\\.\\........................../|........................-........-..................-..............-.|..
../............|\\......|....|.........................../....-..\\.............../.............-........|......
........./.........|\\........................|.\\....................|\\........................|....../........
.../..........|......../....-......../.................\\................-...\\............/...........-....|...
...................../...../../..-........\\/............-./..|................../.............................
............./.......\\..-/.........\\..../..................|.\\...\\...-..-.-............\\..../....|........|\\..
...../........|..............\\..|.|...|.-......-....\\.......................-.\\.......\\...........|...........
..............\\..|................................/-.....-...|.............\\..//..\\......|...............|....
...............................-......|\\............../.\\.\\............./......\\..............................
............|/...\\.....|.......|..\\....................\\.../..................................................
|........../......../............\\../...\\...\\.....-........|../................\\-.............../.........\\...
.....|...-...................../..-...................\\........|./.......-...\\-.../....|.................|....
...........-..................................\\.......\\....../..............................|.................
........./.\\................\\...-.|........./......\\................-.../........|...\\.....\\.....|............
.-....../......./....-...................\\.............-....................|.-.\\./........................\\..
........./...../..........................-...............\\........-....................................\\.....
\\..|...........................\\/...-................................................./.......-..\\....\\.......
....-.|/../...../......./....................-..........-......-.........\\.........../...................\\....
.................................../.........|...........................\\.....-..../.........................
............/..../.../......\\........................-.......|............-........./|........-...............
../......../..........-.........................................................-.........\\..-|...............
...../../...................|.................|.........................................../......./..........\\
...|..........||......................./......./...-..|..\\/......./................\\.\\........../...\\.........
..-.\\\\..|................|....-.......................................-......../.../............|.............
..............-../...............................-.......................\\....................|..........././.
...\\............/.................|.-.|............./......|......-./...............\\.\\.................-.....
.............|.............\\......|.................-|...|.........|.....-......../.......|...................
...\\-............-..-................/.............-.......\\............\\.........-|...\\.............|........
..........|.....\\...../...\\....../|.|.|......../-....--....\\........|...........|..........\\..................
...............\\......./.....|............................|./.............-.|.......\\.-............\\.......|..
....-..........................|\\....................................................................-........
............\\........|...../\\/-........|./.......|..-........................../../.......-..........-........
-..\\............\\..\\.../.......\\.........\\..............\\....../...........-.......\\....................|.....
........|..........|.............|.............-..|..................|....-\\.././......|.............|........
..../......................../|..|......................|..............................|...................-..
.......-/.../........-........................\\....-./.-...........|........./....\\...........-...../.........
........./-\\........../.................-.......\\...................-...\\.......\\.-...........\\...............
.........................\\.../..........................||..|.|...............................................
...................-........./..../........................\\................-.....................|...........
...................................|.....\\...........|.........\\.../.-.-.......-....-....\\.............//.|.|.
..../............|-.......././.........-............\\.....-......-................-......\\........\\.........-.
.\\......................\\.|...\\.-........\\..............-..................-.........................../.../..
..............|..\\../...............\\|..........\\./...................\\...........|...........................
....|......\\.-\\.................-..................../........\\....-...../.............-.\\.|..................
......................-.|..|........................\\...............-..\\..-..../....../...........|...\\.......
...........|......\\................../....-...\\|................\\......../|........................|.........-
...........-.............-...-................\\...-.......|.........../........-..............................
............|................|....--.........../-.....|......\\.............../.........../...|................
-.....\\............/....../.......|.........../...............................-.....//.................-......
-..............|...........-..........|..-|-...-...........................................\\...........|......
...../......|........-...\\.................-......|.......-.......................|..................././..-..
\\..........................................\\...-..\\......./......-.......\\.....|..\\....\\.../.\\..........|...\\.
............./.........-............../....|..../...-....|...-........\\............\\...................|......
/.......|-..../..\\.....\\..............................\\............|..............-.....|..../............-...
............\\................................................/......\\..............\\.|........................
\\/..../.........|\\.....|.../....................../.../..-............-..........-.../.-..../.................
.......|-..|...................../................\\..............\\............/........../\\...|..../..........
........................................................................\\............/.....-.\\.-..............
.......................\\.........../........\\......./.........|.............\\..|....................-.........
.|.../-.......-.....\\...................|.........||..\\...|.-....|....\\..............\\.......-.|.......\\/.....
........../.|.........|............../........\\...........|.-..................\\.\\-..........\\...-............
....\\./..........\\.........\\../......||........\\..\\......-..........................................\\....\\....
|...........\\.............../.....|............|..............\\...............-............|....\\.....-.......
.||................................|..|..\\../...-........................\\..................\\.......|.........
....................-.....\\..........................-|--|../.\\............................||......../........
........|..../........................|........\\....-...|.../.............|.../../....\\..-..............-.....
.......\\...\\......-...-.....................|....\\............-...|.-....\\.....-......-.......................
..-......./...................../..../..........-\\......./..-./.................\\.\\..............|............
....../............../................\\.........-......./..................................././...|...........
......|-..................|-....|...../.|....................-............................\\...................
...........|.......................................|....\\........./......./../......................\\|........
..............|.\\........../.........................../......|.........................../............./../..
.........-......\\........\\........-..........|...|..............|........./....-........../.././......./......
............|.........\\.......\\.........|..............-......./.....|/....../......./....\\.........-\\........
.............-.../..................-.......\\...................-/......-.........|........................\\..
...............|.\\-|//..\\.|............................................/..../...........\\-....................
..........|......./...\\../|.............................................................................../...
...........................|.....--..................................-....\\...||-........./\\......-.....\\.\\...
INPUT

def solve(map, lasers)
  energized = map.map { |line| line.map { { up: false, right: false, down: false, left: false } } }

  until lasers.empty?
    new_lasers = []

    lasers.each do |x, y, direction|
      next if energized[y][x][direction]

      energized[y][x][direction] = true
      field = map[y][x]

      case direction
      when :up
        case field
        when ".", "|"
          new_lasers << [x, y - 1, direction]
        when "/"
          new_lasers << [x + 1, y, :right]
        when "\\"
          new_lasers << [x - 1, y, :left]
        when "-"
          new_lasers << [x - 1, y, :left]
          new_lasers << [x + 1, y, :right]
        end
      when :right
        case field
        when ".", "-"
          new_lasers << [x + 1, y, direction]
        when "/"
          new_lasers << [x, y - 1, :up]
        when "\\"
          new_lasers << [x, y + 1, :down]
        when "|"
          new_lasers << [x, y - 1, :up]
          new_lasers << [x, y + 1, :down]
        end
      when :down
        case field
        when ".", "|"
          new_lasers << [x, y + 1, direction]
        when "/"
          new_lasers << [x - 1, y, :left]
        when "\\"
          new_lasers << [x + 1, y, :right]
        when "-"
          new_lasers << [x - 1, y, :left]
          new_lasers << [x + 1, y, :right]
        end
      when :left
        case field
        when ".", "-"
          new_lasers << [x - 1, y, direction]
        when "/"
          new_lasers << [x, y + 1, :down]
        when "\\"
          new_lasers << [x, y - 1, :up]
        when "|"
          new_lasers << [x, y - 1, :up]
          new_lasers << [x, y + 1, :down]
        end
      end
    end

    lasers = new_lasers.reject do |x, y, _|
      x < 0 || y < 0 || x >= map.first.size || y >= map.size
    end
  end

  result = energized.map { |row| row.map { _1.values.count(true) }.join }
  result.join.size - result.join.count("0")
end

map = input.lines.map { |line| line.chomp.chars }

puts "Part 1: #{solve(map, [[0, 0, :right]])}"

laser_candidates = []
map.each_with_index do |row, y|
  laser_candidates << [0, y, :right]
  laser_candidates << [map[0].size-1, y, :left]
end

map[0].each_with_index do |_, x|
  laser_candidates << [x, 0, :down]
  laser_candidates << [x, map.size-1, :up]
end

puts "Part 2: #{laser_candidates.map { |laser| solve(map, [laser]) }.max}"
