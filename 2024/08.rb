input = <<~INPUT.strip
............
........0...
.....0......
.......0....
....0.......
......A.....
............
............
........A...
.........A..
............
............
INPUT

input = DATA.read
map = input.lines.map(&:chomp)

antenna = {}

map.each_with_index do |row, y|
  row.chars.each_with_index do |elem, x|
    next if elem == "."
    antenna[elem] ||= []
    antenna[elem] << [x, y]
  end
end

def slope(ax, ay, bx, by)
  [bx - ax, by - ay]
end

def out_of_bounds?(map, x, y)
  x < 0 || y < 0 || x > map[0].size - 1 || y > map.size - 1
end

antinodes = []

antenna.keys.each do |key|
  antenna[key].combination(2).each do |(ax, ay), (bx, by)|
    sx, sy = slope(ax, ay, bx, by)

    antinodes << [ax - sx, ay - sy, key] unless out_of_bounds?(map, ax - sx, ay - sy)
    antinodes << [bx + sx, by + sy, key] unless out_of_bounds?(map, bx + sx, by + sy)
  end
end

puts "Part 1"
puts antinodes.uniq { |(x, y) | [x, y] }.reject { |(x, y, key)|
  antenna[key].include?([x, y])
}.size

antinodes = []

antenna.keys.each do |key|
  antenna[key].combination(2).each do |(ax, ay), (bx, by)|
    sx, sy = slope(ax, ay, bx, by)

    (0..).each do |i|
      break if out_of_bounds?(map, ax - i * sx, ay - i * sy)
      antinodes << [ax - i * sx, ay - i * sy]
    end

    (0..).each do |i|
      break if out_of_bounds?(map, bx + i * sx, by + i * sy)
      antinodes << [bx + i * sx, by + i * sy]
    end
  end
end

puts "Part 2"
puts antinodes.uniq.size

__END__
.AU..Z.....8.......................t..C.6.........
..................................................
.....K.U....................v.....................
...Z..A.............................v8.....t......
p..................a8...........b...t.............
..pU.....A..4.....................................
..........................E.......................
...........K..V..............v8.....Cb............
....V................b...p........................
....7.............................................
....4.....A..........V......K..E.....6............
.4.........................Vb...........0..C......
..................................k........N......
K....7...........9...........6.....kE.............
......7......1...................k.......C........
...p....................9....0.....N6.............
..........Z........e..1...........................
.............................E................N...
...4...............................v0..........z..
........U.....Z......1................z..a........
.....5.......7......................N.............
....................n.............................
.......................0.9...c..........z.d.T.....
...................n.W......a...t......D....d.....
..........I.....e......................o9.........
....5..2................e...........D.............
...........................n......D...............
......25I...1..................c......W.......o...
................n..............D..................
...........I........i..e..........................
......5......2.....P..............a...............
...........................z..................T...
..........j.....................Wd...........O..o.
................................................c.
.................I................B...............
...........u.............................T.d......
.............................................J....
.....3.i....u......................o..............
3...i.............................................
..................................................
...........j...............W....O............w....
...P........................J.....................
.....u............................................
.............................w....................
......u.................2...w...J.................
.....j.....B3......................O..............
P....B..............................c.............
................B.............w...................
.....i.............3..............................
..P.j....................J..........O.............
