input = <<~INPUT.strip
.......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
INPUT

input = DATA.read

map = input.lines.map { _1.chomp.chars }

beams = {}
map.each_with_index do |row, y|
  row.each_with_index do |cell, x|
    beams[[x, y]] = 1 if cell == "S"
  end
end

split_count = 0

until beams.keys.any? { |_, y| y >= map.size - 1 }
  beams = {}.tap do |new_beams|
    beams.each do |(x, y), t|
      if map[y + 1][x] == "^"
        [-1, 1].each do |dx|
          new_beams[[x - dx, y + 1]] ||= 0
          new_beams[[x - dx, y + 1]] += t
        end
        split_count += 1
      else
        new_beams[[x, y + 1]] ||= 0
        new_beams[[x, y + 1]] += t
      end
    end
  end
end

puts "Part 1: #{split_count}"
puts "Part 2: #{beams.values.sum}"

__END__
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^...^....................................................................
.............................................................................................................................................
...................................................................^...^.^...................................................................
.............................................................................................................................................
..................................................................^.^.^.^.^..................................................................
.............................................................................................................................................
.................................................................^.^.^.^.^.^.................................................................
.............................................................................................................................................
................................................................^.^.......^.^................................................................
.............................................................................................................................................
...............................................................^.....^.....^.^...............................................................
.............................................................................................................................................
..............................................................^.^.........^...^..............................................................
.............................................................................................................................................
.............................................................^.^...^.....^.^.^.^.............................................................
.............................................................................................................................................
............................................................^.^.^.....^.^.^...^.^............................................................
.............................................................................................................................................
...........................................................^.^.....^...^...^.^.^.^...........................................................
.............................................................................................................................................
..........................................................^.^.^.^.^.^...^.......^.^..........................................................
.............................................................................................................................................
.........................................................^.^.^...^.^...^.^.^.....^.^.........................................................
.............................................................................................................................................
........................................................^.^.^...^.^.^.....^.^.^.^...^........................................................
.............................................................................................................................................
.......................................................^...^.^...^.^.^.^.^.^.^...^.^.^.......................................................
.............................................................................................................................................
......................................................^.^.....^.....^.^...^.^.^.^.....^......................................................
.............................................................................................................................................
.....................................................^.....^.^.^.^...^.^.^.^.^.^.^.^.^.^.....................................................
.............................................................................................................................................
....................................................^...^.^.^.^...^...^.^.^.^...^.^.....^....................................................
.............................................................................................................................................
...................................................^.^...^.^.^...^.^.....^.^.^.^.^...^.^.^...................................................
.............................................................................................................................................
..................................................^.......^...^.^.^.^.^.^.^.^.^.^.^.^.....^..................................................
.............................................................................................................................................
.................................................^...^...^...^.^.^.........^...^.^.....^.^.^.................................................
.............................................................................................................................................
................................................^...^.^.....^.^.^...^.^.^.^.^.^.......^...^.^................................................
.............................................................................................................................................
...............................................^.^...^...^.........^.^.^.^.^.^.....^.^.....^.^...............................................
.............................................................................................................................................
..............................................^.^...^...^.^.^.^.^.^.^.^...^.^.^.^...^.^.^.....^..............................................
.............................................................................................................................................
.............................................^.^.^...^...^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.^...^.............................................
.............................................................................................................................................
............................................^...^.^.^.^.....^.^...^.^.^.^.^.....^.^.^...^.^.^...^............................................
.............................................................................................................................................
...........................................^.^.^.......^.^.^...^...^...^...^.....^...^.^.^.^.....^...........................................
.............................................................................................................................................
..........................................^...^.^.^.^.^...^.^.^.^.^.^...^.^...^.^.^...^.^.^...^.^.^..........................................
.............................................................................................................................................
.........................................^...^.^...^.^.......^...^.^...^.^...^.^.^.^.^.^.^.^.^...^.^.........................................
.............................................................................................................................................
........................................^.^...^.^.........^.^.^.^.^.^.....^.^.^.....^.^.^.^.^...^...^........................................
.............................................................................................................................................
.......................................^.^.^.^...^.....^.^.^.^.^...^.^...^.^.^.^.^.^...^.^.^...^...^.^.......................................
.............................................................................................................................................
......................................^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^...^.....^.^.^...^.^.^.^.^.^.^.^......................................
.............................................................................................................................................
.....................................^.^.^.^.^.^.^.^...^.^...^.^.^.^...^.....^.^.^...^.^...^.^.^...^...^.....................................
.............................................................................................................................................
....................................^.^.......^.^.^...^.^.^.^.^...^.^.^...^.^...^...^...^.....^.^.....^.^....................................
.............................................................................................................................................
...................................^.^.^.^.^.^.....^.^.^.^.^.^.^...^.^...^...^.^.^...^.^.^.^...^.^...^...^...................................
.............................................................................................................................................
..................................^.....^.^.^.^...^.^.^.^.^.^...^.^.......^...^.^.^.^.^...^.^.^...^...^...^..................................
.............................................................................................................................................
.................................^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^...^.....^.^.^.^.^.^...^.^.....^.................................
.............................................................................................................................................
................................^.^...^.^.^.^.^.^...^.^.^...^...^.^.^.^.^...^...^.....^.^.^.^.^.....^.....^.^................................
.............................................................................................................................................
...............................^.....^.^.^.^.^.^...^.^.^.^...^.^...^.....^...^.....^...^...^.^...^.^.^...^.^.^...............................
.............................................................................................................................................
..............................^.^.....^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.....^.^.^...........^.^...^...^...^.^..............................
.............................................................................................................................................
.............................^...^.....^.^.^.^...^.....^.^.^.^.........^.^.^...^.^.^...^.^.^.^.^.^.^.^.^...^...^.............................
.............................................................................................................................................
............................^.^.^...^.^.^.^...^.....^.^.^.^.^...^.^.^.^.^...^...^.^.^.^.^...^.^.^.^...^.^.^.^...^............................
.............................................................................................................................................
...........................^.^.......^.....^.^.....^...^.^.^...^.^.^.^.^.^...^.^.^.^.^.^...^.^.^.^.......^.^.^...^...........................
.............................................................................................................................................
..........................^.^.^.^.....^.^.^.......^...^.^...^...^.^.^.^.....^...^.^.^.^...^.^...^...^.^.^...^.^...^..........................
.............................................................................................................................................
.........................^...^...^.^.^.^...^...^.^.^.^...^.^.^.^.^...^.^.........^.^.^.^.^...^.^.^...^.....^.......^.........................
.............................................................................................................................................
........................^.^...^.^.^.^.^.^.^...^.^.^...^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^.^.....^.^.^.....^........................
.............................................................................................................................................
.......................^.^.^.......^.^...^.^.^.^.^.^...^.......^.^.^.^.^...^...^.^...^.^.^.^.^.^.^.^...^.^...^.^.^...^.......................
.............................................................................................................................................
......................^.^.^...^.^.^...^.^.^.^.^...^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.....^.^...^.^.^.^.^.^.^.^.......^......................
.............................................................................................................................................
.....................^.^.^.^...^...^.^...^.^.^.^.^.^...^.^.^.....^.^...^.....^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.....................
.............................................................................................................................................
....................^.^.^.^.^.^.^.^.^.^.........^.^.^...^.^.^.^.......^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^...^...^.....^.^....................
.............................................................................................................................................
...................^.^.^.^.^.^.^.....^.^.^.^.^.^.....^.^.....^.^.....^.^.........^...^...^.^...^.^...^.^.^.^.^.^.^.^.....^...................
.............................................................................................................................................
..................^.....^...^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.....^.......^...^...^.......^.^.^.^.^.^...^.^.....^..................
.............................................................................................................................................
.................^.^.^.^...^.^.^.^.........^.^.^.....^.^.^.^.......^...^.^...^...^.^.^.....^.^...^...^.^.^.....^.^...^.^.^.^.................
.............................................................................................................................................
................^...^.^...^.^...^.^.^.^.^...^.^.........^...^.^.....^...^.^...^.^...^.^...^.^.^.^.^.^...^.^.^...^.^.^.^.^...^................
.............................................................................................................................................
...............^.^.^.......^.^.^...^.^.^.^.^...^...^.^...^...^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.....^...^.^...^.^.....^.^...^...............
.............................................................................................................................................
..............^...^.....^.^.^.^.^.^...^...^.....^.^.^.^.^.^...^.^.^.^...^.^.^...^...^.^.^.......^...^.^...^.^.^.^.......^.^...^..............
.............................................................................................................................................
.............^...^...^.^...^.^.^.^.^.^...^...^.^.^.^.^.^.....^...^...^.....^...^.^.....^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^.............
.............................................................................................................................................
............^...^.^.^...^.^...^.^.^.^.^.......^.^.....^.....^.^.^.^.^...^.^.^.^...^.....^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^............
.............................................................................................................................................
...........^.^.^.....^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.....^...^.^.^...^.^...^.^.^...^.^.^.^...^.^.^...^...^.^.^.^...^.....^.^.^.^...........
.............................................................................................................................................
..........^.^.^.^...^.^...^...^...........^.^.^.^.^.^.^.^...^.^.^.^.^.^...........^.^.^...^.^.^.^.....^.^.^.^.^.^.^.^.^...^.^.^.^.^..........
.............................................................................................................................................
.........^.^.^.^...^.^...^...^...^.......^...^.^.....^.^.^.....^.^.^.^...^.^...^.^.^.^.....^.^.^.^.^...^.^...^.^...^.^...^.^...^.^.^.........
.............................................................................................................................................
........^.^.....^.^.^.^...^.^.^.^.....^.^...^.^.^.^.....^.^.^.^.^.^.^.^...^.^.....^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.^.^...^........
.............................................................................................................................................
.......^.^.^.^.^.....^.....^.^.^.^.^...^...^...^...^.^.^.^.^.......^...^.^...^.^.^.^.^.^.^...^.^.^...^.^.^.^...^.^.^.^.^...^.^.^...^.^.......
.............................................................................................................................................
......^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^...^.^.^...^.^.^.^.^.^...^.^.....^...^.^.^...^.^...^.....^.^.^.^.^.^.^.^.^.^.^.....^.^.^......
.............................................................................................................................................
.....^.^.^.^.^.^.^.^...^.^.^.......^.^.^.^...^.^.^.....^.^.....^.^...^.^.^...^.^.^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.....^.^.^.^.^.^...^.....
.............................................................................................................................................
....^...^.^.^.^.^.^.^...^.^.^...^.^.^.^...^.^.^.....^.^...^.^.^.^...^.^.^.....^.^.^.^.^.....^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^....
.............................................................................................................................................
...^...^.......^.^...^.^.^.^...^.^.^.^.....^...^.^.......^.^.^.^.^.^.^.^...^.^.....^.^.^.^.^.^.^.^.....^.^...^...^.^.^.....^...^.......^.^...
.............................................................................................................................................
..^.^.^...^.^.^.....^.^.^...^...^...^...^.^.^.^.^.^.^.....^.^.^...^.....^.^.^.^.^...^.^...^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^...^.^.^...^.^..
.............................................................................................................................................
.^.^.......^.^.^.^.^.^.^...^.....^.^...^.^.^.^.^.^...^...^.^...^.^.........^.....^.^.^.^.....^.^.^.^.^...^.^.^.^.^.^.^.^.^.^...^...^.^...^.^.
.............................................................................................................................................
